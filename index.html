<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Social Engineering</title>

<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>

<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Rajdhani', sans-serif; background:#1a1d35; color:#fff; line-height:1.6; }
.container { max-width:1200px; margin:0 auto; padding:20px; }
header { text-align:center; margin-bottom:30px; }
h1 { font-size:2.5rem; letter-spacing:3px; font-weight:700; }
.subtitle { color:#8b95a5; font-size:1.1rem; margin-top:10px; letter-spacing:1px; }

/* Upload */
.upload-section { background:#22253a; padding:30px; border-radius:12px; margin-bottom:30px; box-shadow:0 4px 6px rgba(0,0,0,0.3);}
.upload-section h2 { margin-bottom:20px; color:#fff; font-size:1.3rem; }
.upload-area { border:3px dashed #2962FF; padding:40px 20px; text-align:center; cursor:pointer; border-radius:12px; transition:all 0.3s ease; background: rgba(41,98,255,0.05);}
.upload-area.dragover { border-color:#4CAF50; background: rgba(76,175,80,0.15); transform:scale(1.02);}
.file-input { display:none; }
.file-info { margin-top:15px; font-size:0.95rem; color:#27ae60; font-weight:500;}
.error-msg { margin-top:15px; font-size:0.95rem; color:#e74c3c; font-weight:500; }

/* Table */
.table-container { background:#22253a; padding:30px; border-radius:12px; margin-bottom:30px; box-shadow:0 4px 6px rgba(0,0,0,0.3); display:none; }
.search-box { padding:12px 15px; background:#2c2f4d; border:2px solid #3a3d5c; border-radius:8px; color:#fff; font-size:0.95rem; transition: all 0.3s ease; }
.search-box:focus { outline:none; border-color:#2962FF; background:#1a1d35; }
.upload-btn { padding:12px 24px; background:#2962FF; color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition:all 0.3s ease;}
.upload-btn:hover { background:#1e4ed8; transform:translateY(-2px); }
table { width:100%; border-collapse:collapse; margin-bottom:20px;}
th, td { padding:12px 15px; text-align:left; font-size:0.9rem; border-bottom:1px solid #2c2f4d; }
th { background:#1a1d35; font-weight:600; letter-spacing:1px; color:#a8b2c1; }
tr:hover { background: rgba(41, 98, 255, 0.05);}
.screenshot-thumbnail { width:80px; height:50px; object-fit:cover; cursor:pointer; border-radius:6px; transition:all 0.3s ease; border:2px solid #2c2f4d;}
.screenshot-thumbnail:hover { transform:scale(1.1); border-color:#2962FF; }

/* Pagination */
.pagination { text-align:center; margin:20px 0; display:flex; justify-content:center; align-items:center; gap:15px;}
.pagination button { padding:10px 20px; background:#2c2f4d; border:2px solid #3a3d5c; color:#fff; border-radius:8px; cursor:pointer; font-weight:600; transition:all 0.3s ease;}
.pagination button:hover:not(:disabled) { background:#2962FF; border-color:#2962FF; }
.pagination button:disabled { opacity:0.3; cursor:not-allowed; }
#pageInfo { font-weight:600; color:#a8b2c1; }

/* Modal */
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background: rgba(0,0,0,0.95); justify-content:center; align-items:center;}
.modal-content { max-width:90%; max-height:90%; border-radius:8px; }
.close { position:absolute; top:30px; right:40px; color:#fff; font-size:40px; font-weight:bold; cursor:pointer; }
.close:hover { color:#2962FF; transform:scale(1.2); }

@media(max-width:768px){ h1{font-size:1.8rem;} .container{padding:15px;} }
</style>
</head>
<body>
<div class="container">

<header>
<h1>DASHBOARD SOCIAL ENGINEERING</h1>
<div class="subtitle">Siti di Phishing & Superficie di Attacco Umano</div>
</header>

<div class="upload-section">
<h2>CARICA DATI CSV</h2>
<div class="upload-area" id="uploadArea">
<div class="upload-icon">üìä</div>
<p>Clicca per caricare il file CSV</p>
<p style="color:#8b95a5;">oppure trascina qui</p>
<input type="file" id="fileInput" class="file-input" accept=".csv">
</div>
<div id="fileInfo" class="file-info"></div>
<div id="errorMsg" class="error-msg"></div>
</div>

<div class="table-container" id="tableContainer">
<div style="display:flex;gap:10px;margin-bottom:10px;">
<input type="date" id="dateStartFilter" class="search-box">
<input type="date" id="dateEndFilter" class="search-box">
<select id="sectorFilter" class="search-box"><option value="">Tutti i Settori</option></select>
<select id="goalFilter" class="search-box"><option value="">Tutti gli Obiettivi</option></select>
<button id="resetFiltersBtn" class="upload-btn" style="background:#e74c3c;">Reset</button>
</div>

<table>
<thead>
<tr>
<th>Sito</th><th>Data</th><th>Settore</th><th>Obiettivo</th><th>Screenshot</th>
</tr>
</thead>
<tbody id="tableBody">
<tr><td colspan="5" style="text-align:center;color:#8b95a5;">Nessun dato caricato</td></tr>
</tbody>
</table>

<div class="pagination">
<button id="prevBtn">‚Üê Precedente</button>
<span id="pageInfo">Pagina 1</span>
<button id="nextBtn">Successivo ‚Üí</button>
</div>
</div>

<div id="imageModal" class="modal" onclick="closeModal()">
<span class="close" onclick="closeModal()">&times;</span>
<img class="modal-content" id="modalImage">
</div>

</div>

<script>
// Variabili globali
let currentData=[], filteredData=[], currentPage=1;
const rowsPerPage=10;

// Upload file
const uploadArea=document.getElementById('uploadArea');
const fileInput=document.getElementById('fileInput');
uploadArea.onclick=()=>fileInput.click();
uploadArea.addEventListener('dragover',e=>{e.preventDefault(); uploadArea.classList.add('dragover');});
uploadArea.addEventListener('dragleave',()=>uploadArea.classList.remove('dragover'));
uploadArea.addEventListener('drop',e=>{e.preventDefault(); uploadArea.classList.remove('dragover'); const file=e.dataTransfer.files[0]; if(file) handleFile(file);});
fileInput.addEventListener('change',e=>{ const file=e.target.files[0]; if(file) handleFile(file);});

// Modal immagini
function showImage(path){ document.getElementById('imageModal').style.display='flex'; document.getElementById('modalImage').src=path;}
function closeModal(){ document.getElementById('imageModal').style.display='none';}
document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeModal();});

// Gestione CSV
function handleFile(file){
if(!file.name.endsWith('.csv')){ document.getElementById('errorMsg').textContent='Solo file CSV!'; return;}
const reader=new FileReader();
reader.onload=e=>parseCSV(e.target.result);
reader.readAsText(file);
}

function parseCSV(text){
const lines=text.split(/\r?\n/).filter(l=>l.trim()!=='');
const headers=lines.shift().split(';').map(h=>h.trim().toLowerCase());
currentData=lines.map((line,rowIndex)=>{
const values=line.split(';').map(v=>v.trim());
const obj={rowIndex};
headers.forEach((h,i)=>obj[h]=values[i]||'');
return {rowIndex, site: obj.site||obj.sito||'', date: obj.date||obj.data||'', sector: obj.sector||obj.settore||'', goal: obj.goal||obj.obiettivo||''};
});
document.getElementById('tableContainer').style.display='block';
populateFilters(currentData);
applyFilters();
}

// Filtri
function parseDateSafe(str){ return str? new Date(str) : null;}
function applyFilters(){
const start=parseDateSafe(document.getElementById('dateStartFilter').value);
const end=parseDateSafe(document.getElementById('dateEndFilter').value);
const sector=document.getElementById('sectorFilter').value;
const goal=document.getElementById('goalFilter').value;

filteredData=currentData.filter(r=>{
const d=parseDateSafe(r.date);
if(start && (!d || d<start)) return false;
if(end && (!d || d>end)) return false;
if(sector && r.sector!==sector) return false;
if(goal && r.goal!==goal) return false;
return true;
});
displayPage(1);
}
document.getElementById('dateStartFilter').addEventListener('change',applyFilters);
document.getElementById('dateEndFilter').addEventListener('change',applyFilters);
document.getElementById('sectorFilter').addEventListener('change',applyFilters);
document.getElementById('goalFilter').addEventListener('change',applyFilters);
document.getElementById('resetFiltersBtn').addEventListener('click',()=>{
document.getElementById('dateStartFilter').value='';
document.getElementById('dateEndFilter').value='';
document.getElementById('sectorFilter').value='';
document.getElementById('goalFilter').value='';
applyFilters();
});

// Popola select
function populateFilters(data){
const sectors=[...new Set(data.map(r=>r.sector))].sort();
const sectorSelect=document.getElementById('sectorFilter');
sectorSelect.innerHTML='<option value="">Tutti i Settori</option>';
sectors.forEach(s=>{ const o=document.createElement('option'); o.value=s; o.textContent=s; sectorSelect.appendChild(o); });
const goals=[...new Set(data.map(r=>r.goal))].sort();
const goalSelect=document.getElementById('goalFilter');
goalSelect.innerHTML='<option value="">Tutti gli Obiettivi</option>';
goals.forEach(g=>{ const o=document.createElement('option'); o.value=g; o.textContent=g; goalSelect.appendChild(o); });
}

// Paginazione
document.getElementById('prevBtn').onclick=()=>{ if(currentPage>1){currentPage--; displayPage(currentPage);}};
document.getElementById('nextBtn').onclick=()=>{ const total=Math.ceil(filteredData.length/rowsPerPage); if(currentPage<total){currentPage++; displayPage(currentPage);}};
function getImagePath(rowIndex){ return `images/${rowIndex+1}.png`; }
function displayPage(page){
currentPage=page;
const tbody=document.getElementById('tableBody');
tbody.innerHTML='';
const start=(page-1)*rowsPerPage;
const pageData=filteredData.slice(start,start+rowsPerPage);
if(pageData.length===0){ tbody.innerHTML='<tr><td colspan="5" style="text-align:center;color:#8b95a5;">Nessun dato trovato</td></tr>'; return;}
pageData.forEach(r=>{
const dateDisplay=r.date?r.date.substring(0,10):'-';
const siteDisplay=r.site.length>50?r.site.substring(0,47)+'...':r.site;
const imgPath=getImagePath(r.rowIndex);
tbody.innerHTML+=`<tr>
<td title="${r.site}">${siteDisplay}</td>
<td>${dateDisplay}</td>
<td>${r.sector}</td>
<td>${r.goal}</td>
<td class="screenshot-cell"><img src="${imgPath}" class="screenshot-thumbnail" onclick="event.stopPropagation(); showImage('${imgPath}')" onerror="this.style.display='none'"></td>
</tr>`;
});
const totalPages=Math.ceil(filteredData.length/rowsPerPage)||1;
document.getElementById('pageInfo').textContent=`Pagina ${currentPage} di ${totalPages} (${filteredData.length} record)`;
document.getElementById('prevBtn').disabled=currentPage===1;
document.getElementById('nextBtn').disabled=currentPage===totalPages;
}
</script>
</body>
</html>
