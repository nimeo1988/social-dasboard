<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Engineering Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* RESET & BASE */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Rajdhani', sans-serif; background: #1a1d35; color: #fff; line-height: 1.6; }
/* CONTAINER */
.container { max-width: 1200px; margin: 0 auto; padding: 20px; }
/* HEADER */
header { text-align: center; margin-bottom: 30px; padding: 20px 0; }
h1 { font-size: 2.5rem; letter-spacing: 3px; font-weight: 700; margin: 0; }
.subtitle { color: #8b95a5; font-size: 1.1rem; margin-top: 10px; letter-spacing: 1px; }
/* UPLOAD SECTION */
.upload-section { background: #22253a; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
.upload-section h2 { margin-bottom: 20px; color: #fff; letter-spacing: 2px; font-size: 1.3rem; }
.upload-area { border: 3px dashed #2962FF; padding: 40px 20px; text-align: center; cursor: pointer; border-radius: 12px; transition: all 0.3s ease; background: rgba(41, 98, 255, 0.05); }
.upload-area:hover { border-color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
.upload-area.dragover { border-color: #4CAF50; background: rgba(76, 175, 80, 0.15); transform: scale(1.02); }
.upload-icon { font-size: 3rem; margin-bottom: 10px; }
.file-input { display: none; }
.file-info { margin-top: 15px; font-size: 0.95rem; color: #27ae60; font-weight: 500; }
.error-msg { margin-top: 15px; font-size: 0.95rem; color: #e74c3c; font-weight: 500; }
/* TABLE CONTAINER */
.table-container { background: #22253a; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); display: none; opacity: 0; transform: translateY(20px); transition: all 0.5s ease; }
.table-container.active { display: block; opacity: 1; transform: translateY(0); }
/* SEARCH & FILTERS */
.search-box { padding: 12px 15px; background: #2c2f4d; border: 2px solid #3a3d5c; border-radius: 8px; color: #fff; font-size: 0.95rem; font-family: 'Rajdhani', sans-serif; transition: all 0.3s ease; }
.search-box:focus { outline: none; border-color: #2962FF; background: #1a1d35; }
.search-box::placeholder { color: #8b95a5; }
/* DATE INPUTS */
.date-input-wrapper { position: relative; width: 100%; }
.date-input-wrapper input[type="date"] { width: 100%; cursor: pointer; }
input[type="date"]::-webkit-calendar-picker-indicator { cursor: pointer; opacity: 1; filter: invert(0.7); font-size: 1.2em; }
input[type="date"]:focus { outline: 2px solid #2962FF; outline-offset: 2px; }
.date-tooltip { position: absolute; bottom: -25px; left: 0; font-size: 0.75rem; color: #8b95a5; pointer-events: none; opacity: 0; transition: opacity 0.3s ease; }
.date-input-wrapper:hover .date-tooltip { opacity: 1; }
/* BUTTON */
.upload-btn { padding: 12px 24px; background: #2962FF; color: #fff; border: none; border-radius: 8px; font-size: 1rem; font-family: 'Rajdhani', sans-serif; font-weight: 600; cursor: pointer; transition: all 0.3s ease; letter-spacing: 0.5px; }
.upload-btn:hover { background: #1e4ed8; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(41, 98, 255, 0.4); }
.upload-btn:active { transform: translateY(0); }
.upload-btn:disabled { background: #555; cursor: not-allowed; transform: none; }
/* TABLE */
table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
th, td { padding: 12px 15px; text-align: left; font-size: 0.9rem; border-bottom: 1px solid #2c2f4d; }
th { background: #1a1d35; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; font-size: 0.85rem; color: #a8b2c1; }
tr:hover { background: rgba(41, 98, 255, 0.05); }
.screenshot-thumbnail { width: 80px; height: 50px; object-fit: cover; cursor: pointer; border-radius: 6px; transition: all 0.3s ease; border: 2px solid #2c2f4d; }
.screenshot-thumbnail:hover { transform: scale(1.1); border-color: #2962FF; box-shadow: 0 4px 12px rgba(41, 98, 255, 0.5); }
.screenshot-cell { text-align: center; }
/* PAGINATION */
.pagination { text-align: center; margin: 20px 0; display: flex; justify-content: center; align-items: center; gap: 15px; }
.pagination button { padding: 10px 20px; background: #2c2f4d; border: 2px solid #3a3d5c; color: #fff; border-radius: 8px; cursor: pointer; font-family: 'Rajdhani', sans-serif; font-weight: 600; transition: all 0.3s ease; }
.pagination button:hover:not(:disabled) { background: #2962FF; border-color: #2962FF; }
.pagination button:disabled { opacity: 0.3; cursor: not-allowed; }
#pageInfo { font-weight: 600; color: #a8b2c1; }
/* MODAL */
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); justify-content: center; align-items: center; }
.modal-content { max-width: 90%; max-height: 90%; border-radius: 8px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); }
.close { position: absolute; top: 30px; right: 40px; color: #fff; font-size: 40px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; }
.close:hover { color: #2962FF; transform: scale(1.2); }
/* CHARTS */
.charts-grid-two-cols { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0; opacity: 0; transform: translateY(20px); transition: all 0.5s ease; }
.charts-grid-two-cols.active { opacity: 1; transform: translateY(0); }
.charts-grid-single { margin: 2rem 0; opacity: 0; transform: translateY(20px); transition: all 0.5s ease; }
.charts-grid-single.active { opacity: 1; transform: translateY(0); }
.chart-card { background: #22253a; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); }
.chart-card h3 { margin-bottom: 20px; color: #fff; font-size: 1.1rem; letter-spacing: 1px; }
.chart-wrapper { position: relative; height: 350px; } /* pi√π alto per desktop */
/* RESPONSIVE */
@media (max-width: 768px) { .charts-grid-two-cols { grid-template-columns: 1fr; } h1 { font-size: 1.8rem; } .container { padding: 15px; } }
</style>
</head>

<body>
<div class="container">

<header>
    <h1>SOCIAL ENGINEERING DASHBOARD</h1>
    <div class="subtitle">Phishing Sites & Human Attack Surface</div>
</header>

<!-- UPLOAD SECTION, TABLE, MODAL RESTANO UGUALI -->
<!-- ... (il tuo codice esistente di upload e tabella rimane invariato) -->

<!-- GRAFICI MULTILINE -->
<div class="charts-grid-two-cols" id="chartsGridMonthAndGoals" style="display:none;">
    <div class="chart-card">
        <h3>Attacchi per Mese</h3>
        <div class="chart-wrapper"><canvas id="monthChart"></canvas></div>
    </div>
    
    <div class="chart-card">
        <h3>Attacchi per Obiettivo nel Tempo</h3>
        <div class="chart-wrapper"><canvas id="goalsByMonthChart"></canvas></div>
    </div>
</div>

<script>
let monthChart, goalsByMonthChart;

function updateMonthChart(data){
    if(monthChart) monthChart.destroy();
    const months = {};
    data.forEach(r => {
        if(r.date && r.date.length >= 7) {
            const m = r.date.slice(0, 7);
            months[m] = (months[m] || 0) + 1;
        }
    });
    const sorted = Object.keys(months).sort();
    const counts = sorted.map(m => months[m]);
    
    const monthNames = ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'];
    const labels = sorted.map(m => {
        const [year, month] = m.split('-');
        return `${monthNames[parseInt(month) - 1]} ${year}`;
    });
    
    monthChart = new Chart(document.getElementById('monthChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Campagne',
                data: counts,
                backgroundColor: 'rgba(41, 98, 255, 0.25)',
                borderColor: '#2962FF',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 6,
                pointBackgroundColor: '#2962FF',
                pointBorderColor: '#FFFFFF',
                pointBorderWidth: 3,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {display: false},
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    titleColor: '#FFFFFF',
                    bodyColor: '#FFFFFF',
                    callbacks: {label: function(ctx){ return `Campagne: ${ctx.parsed.y}`; }}
                }
            },
            scales: {
                y: { beginAtZero:true, ticks:{color:'#a8b2c1', font:{size:12}}, grid:{color:'rgba(168,178,193,0.1)'} },
                x: { ticks:{color:'#a8b2c1', font:{size:11}}, grid:{display:false} }
            }
        }
    });
}

function updateGoalsByMonthChart(data){
    if(goalsByMonthChart) goalsByMonthChart.destroy();
    const monthGoalMap = {};
    const allGoals = new Set();
    data.forEach(r => {
        if(r.date && r.date.length >= 7 && r.goal) {
            const month = r.date.slice(0, 7);
            allGoals.add(r.goal);
            if(!monthGoalMap[month]) monthGoalMap[month] = {};
            monthGoalMap[month][r.goal] = (monthGoalMap[month][r.goal] || 0) + 1;
        }
    });
    const sortedMonths = Object.keys(monthGoalMap).sort();
    const goalCounts = {};
    data.forEach(r => { if(r.goal) goalCounts[r.goal] = (goalCounts[r.goal] || 0) + 1; });
    const sortedGoals = Object.entries(goalCounts).sort((a,b) => b[1]-a[1]).map(([g])=>g);
    
    const lineColors = [
        '#2962FF', '#F44336', '#4CAF50', '#FF9800', '#9C27B0',
        '#00BCD4', '#E91E63', '#009688', '#FFC107', '#3F51B5',
        '#FF5722', '#795548', '#607D8B', '#CDDC39', '#8BC34A'
    ];
    
    const datasets = sortedGoals.map((goal, idx)=>({
        label: goal,
        data: sortedMonths.map(month=>monthGoalMap[month][goal] || 0),
        borderColor: lineColors[idx % lineColors.length],
        backgroundColor: 'transparent',
        borderWidth: 3,
        fill: false,
        tension: 0.4,
        pointRadius: 5,
        pointBackgroundColor: lineColors[idx % lineColors.length],
        pointBorderColor: '#FFFFFF',
        pointBorderWidth: 2
    }));
    
    goalsByMonthChart = new Chart(document.getElementById('goalsByMonthChart'), {
        type: 'line',
        data: { labels: sortedMonths, datasets: datasets },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position:'bottom', labels:{color:'#a8b2c1', font:{size:10}, boxWidth:15, padding:8} },
                tooltip: { backgroundColor:'rgba(0,0,0,0.8)', titleColor:'#FFFFFF', bodyColor:'#FFFFFF' }
            },
            scales: {
                y: { beginAtZero:true, ticks:{color:'#a8b2c1', font:{size:12}}, grid:{color:'rgba(168,178,193,0.1)'} },
                x: { ticks:{color:'#a8b2c1', font:{size:10}}, grid:{display:false} }
            }
        }
    });
}
</script>
</div>
</body>
</html>
