<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Social Engineering</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
/* STILI BASE, come prima */
body{margin:0;padding:0;font-family:'Rajdhani',sans-serif;background:#1a1d35;color:#fff;}
.container{max-width:1200px;margin:0 auto;padding:20px;}
header{text-align:center;margin-bottom:30px;}
h1{font-size:2.5rem;letter-spacing:3px;margin:0;}
.subtitle{color:#8b95a5;font-size:1.1rem;margin-top:10px;letter-spacing:1px;}
.upload-section{background:#22253a;padding:30px;border-radius:12px;margin-bottom:30px;}
.upload-area{border:3px dashed #2962FF;padding:40px 20px;text-align:center;cursor:pointer;border-radius:12px;}
.upload-area.dragover{border-color:#4CAF50;background:rgba(76,175,80,0.15);}
.file-input{display:none;}
.file-info{margin-top:15px;font-size:0.95rem;color:#27ae60;font-weight:500;}
.error-msg{margin-top:15px;font-size:0.95rem;color:#e74c3c;font-weight:500;}
.table-container{background:#22253a;padding:30px;border-radius:12px;margin-bottom:30px;display:none;}
.search-box{padding:12px 15px;background:#2c2f4d;border:2px solid #3a3d5c;border-radius:8px;color:#fff;font-size:0.95rem;}
.upload-btn{padding:12px 24px;background:#2962FF;color:#fff;border:none;border-radius:8px;font-size:1rem;cursor:pointer;}
.upload-btn:hover{background:#1e4ed8;}
table{width:100%;border-collapse:collapse;margin-bottom:20px;}
th,td{padding:12px 15px;text-align:left;font-size:0.9rem;border-bottom:1px solid #2c2f4d;}
th{background:#1a1d35;font-weight:600;color:#a8b2c1;text-transform:uppercase;font-size:0.85rem;}
tr:hover{background:rgba(41,98,255,0.05);}
.screenshot-thumbnail{width:80px;height:50px;object-fit:cover;cursor:pointer;border-radius:6px;}
.screenshot-cell{text-align:center;}
.pagination{display:flex;justify-content:center;align-items:center;gap:15px;}
.pagination button{padding:10px 20px;background:#2c2f4d;border:2px solid #3a3d5c;color:#fff;border-radius:8px;cursor:pointer;}
.pagination button:hover:not(:disabled){background:#2962FF;}
.pagination button:disabled{opacity:0.3;cursor:not-allowed;}
#pageInfo{font-weight:600;color:#a8b2c1;}
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.95);justify-content:center;align-items:center;}
.modal-content{max-width:90%;max-height:90%;border-radius:8px;}
.close{position:absolute;top:30px;right:40px;color:#fff;font-size:40px;font-weight:bold;cursor:pointer;}
.close:hover{color:#2962FF;}
.charts-grid-two-cols{display:grid;grid-template-columns:1fr 1fr;gap:2rem;margin:2rem 0;}
.charts-grid-single{margin:2rem 0;}
.chart-card{background:#22253a;padding:25px;border-radius:12px;}
.chart-card h3{margin-bottom:20px;color:#fff;font-size:1.1rem;}
.chart-wrapper{position:relative;height:300px;}
@media(max-width:768px){.charts-grid-two-cols{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div class="container">
<header>
<h1>SOCIAL ENGINEERING DASHBOARD</h1>
<div class="subtitle">Phishing Sites & Human Attack Surface</div>
</header>

<div class="upload-section">
<h2>UPLOAD DATA</h2>
<div class="upload-area" id="uploadArea">
<p>Click or drag & drop file here</p>
<input type="file" id="fileInput" class="file-input" accept=".txt,.csv">
</div>
<div id="fileInfo" class="file-info"></div>
<div id="errorMsg" class="error-msg"></div>
</div>

<div class="table-container" id="tableContainer">
<div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr 100px;gap:1rem;margin-bottom:1rem;">
<input type="date" id="dateStartFilter" class="search-box">
<input type="date" id="dateEndFilter" class="search-box">
<select id="sectorFilter" class="search-box"><option value="">All Sectors</option></select>
<select id="goalFilter" class="search-box"><option value="">All Goals</option></select>
<button id="resetFiltersBtn" class="upload-btn" style="background:#e74c3c;">Reset</button>
</div>

<div style="text-align:center;margin-bottom:1.5rem;">
<button id="generatePdfBtn" class="upload-btn" style="background:#27ae60;">Generate PDF Report</button>
</div>

<table>
<thead>
<tr>
<th>Site</th>
<th>Date</th>
<th>Sector</th>
<th>Goal</th>
<th>Screenshot</th>
</tr>
</thead>
<tbody id="tableBody">
<tr><td colspan="5" style="text-align:center;color:#8b95a5;">No data loaded</td></tr>
</tbody>
</table>

<div class="pagination">
<button id="prevBtn">Previous</button>
<span id="pageInfo">Page 1</span>
<button id="nextBtn">Next</button>
</div>
</div>

<div class="charts-grid-two-cols">
<div class="chart-card">
<h3>Distribuzione per Settore</h3>
<div class="chart-wrapper"><canvas id="allSectorsChart"></canvas></div>
</div>
<div class="chart-card">
<h3>Top 5 Settori</h3>
<div class="chart-wrapper"><canvas id="top5SectorsBarChart"></canvas></div>
</div>
</div>

<div class="charts-grid-single">
<div class="chart-card">
<h3>Distribuzione Obiettivi</h3>
<div class="chart-wrapper"><canvas id="goalsPieChart"></canvas></div>
</div>
</div>

<div class="charts-grid-two-cols">
<div class="chart-card">
<h3>Attacchi per Mese</h3>
<div class="chart-wrapper"><canvas id="monthChart"></canvas></div>
</div>
<div class="chart-card">
<h3>Obiettivi nel Tempo</h3>
<div class="chart-wrapper"><canvas id="goalsByMonthChart"></canvas></div>
</div>
</div>

<div id="imageModal" class="modal" onclick="closeModal()">
<span class="close">&times;</span>
<img class="modal-content" id="modalImage">
</div>

<script>
// JS originale per parser, filtri, grafici, modal e PDF
let currentData=[], filteredData=[], currentPage=1, rowsPerPage=10;
const uploadArea=document.getElementById('uploadArea');
const fileInput=document.getElementById('fileInput');
const fileInfo=document.getElementById('fileInfo');
const errorMsg=document.getElementById('errorMsg');

uploadArea.onclick=()=>fileInput.click();
uploadArea.addEventListener('dragover',e=>{e.preventDefault();uploadArea.classList.add('dragover');});
uploadArea.addEventListener('dragleave',()=>uploadArea.classList.remove('dragover'));
uploadArea.addEventListener('drop',e=>{e.preventDefault();uploadArea.classList.remove('dragover');if(e.dataTransfer.files[0])handleFile(e.dataTransfer.files[0]);});
fileInput.addEventListener('change',e=>{if(e.target.files[0])handleFile(e.target.files[0]);});

function getLocalImagePath(name){return name?`https://raw.githubusercontent.com/username/repo/main/images/${name}`:'';}
function showImage(path){document.getElementById('modalImage').src=path;document.getElementById('imageModal').style.display='flex';}
function closeModal(){document.getElementById('imageModal').style.display='none';}
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal();});

function handleFile(file){
    errorMsg.textContent=''; fileInfo.textContent='Loading '+file.name;
    const reader=new FileReader();
    reader.onload=function(e){
        try{
            const lines=e.target.result.split(/\r?\n/).map(l=>l.trim()).filter(l=>l!=='');
            const data=[];
            for(let i=0;i<lines.length;i+=8){
                const row={site:lines[i],date:lines[i+1],screenshot:lines[i+5],sector:lines[i+6],goal:lines[i+7]};
                if(row.site)data.push(row);
            }
            currentData=data; filteredData=data;
            fileInfo.textContent='Loaded '+data.length+' records';
            document.getElementById('tableContainer').style.display='block';
            populateFilters(data); displayPage(filteredData,1); updateAllCharts(filteredData);
        }catch(err){errorMsg.textContent='Error: '+err.message;}
    };
    reader.readAsText(file);
}

// Le altre funzioni JS (filtri, tabelle, grafici, PDF) rimangono identiche a prima...
</script>
</body>
</html>